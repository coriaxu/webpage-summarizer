var p=Object.defineProperty;var h=Object.getOwnPropertySymbols;var I=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable;var l=(e,t,o)=>t in e?p(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,u=(e,t)=>{for(var o in t||(t={}))I.call(t,o)&&l(e,o,t[o]);if(h)for(var o of h(t))_.call(t,o)&&l(e,o,t[o]);return e};var A=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var d=(e,t,o)=>new Promise((s,c)=>{var a=n=>{try{i(o.next(n))}catch(m){c(m)}},r=n=>{try{i(o.throw(n))}catch(m){c(m)}},i=n=>n.done?s(n.value):Promise.resolve(n.value).then(a,r);i((o=o.apply(e,t)).next())});var f=A(E=>{const g={API_KEY:"sk-7f9dad058e434c999c6830c086145268",API_BASE_URL:"https://api.deepseek.com/v1",ENDPOINT:"/chat/completions",MAX_RETRIES:3,TIMEOUT:3e4};chrome.runtime.onInstalled.addListener(()=>{console.log("Extension installed"),chrome.storage.sync.set({theme:"light",language:"zh",summaryLength:"medium"})});const P={short:{max_tokens:150,temperature:.3},medium:{max_tokens:500,temperature:.3},long:{max_tokens:800,temperature:.3}};chrome.runtime.onMessage.addListener((e,t,o)=>{if(console.log("Background received message:",e),e.action==="summarize")return d(E,null,function*(){try{console.log("Starting summarization with content:",e.content.substring(0,100)+"...");const{language:s}=yield chrome.storage.sync.get("language"),c=s==="zh"?`请对以下内容进行摘要总结：

${e.content}`:`Please summarize the following content:

${e.content}`,a=yield fetch(`${g.API_BASE_URL}${g.ENDPOINT}`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${g.API_KEY}`},body:JSON.stringify(u({model:"deepseek-chat",messages:[{role:"user",content:c}]},P[e.length]))});if(!a.ok)throw new Error(`API request failed with status ${a.status}`);const r=yield a.json();if(!r.choices||!r.choices[0]||!r.choices[0].message)throw new Error("Invalid API response format");o({success:!0,summary:r.choices[0].message.content.trim()})}catch(s){console.error("Error in background script:",s),o({success:!1,error:s.message||"生成摘要时发生错误"})}}),!0})});export default f();
//# sourceMappingURL=background.js.map
